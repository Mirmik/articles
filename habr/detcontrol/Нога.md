# Механическое управление механической ногой.

Задача управления конечностью робота, это задача управления манипулятором с некоторым небольшим числом звеньев. Задача эта принципиально решена и довольно хорошо описана. Мы довольно неплохо умеем в создание манипуляторов, что можно понять, взглянув хотя бы взглянув на сборочные линии автомобилестроительных заводов.

У рук и ног, впрочем, есть некоторые отличные от стационарных роботов манипуляторов особенности. 

Во первых конечность закреплена на подвижном основании и, если брать тело за точку отсчета, что естественно для автономного робота, конечность работает в неинерциальной системе координат. 

Во вторых конечности, отвечающие за передвижение тела в пространстве двунаправлены. Часть времени конечность занимается тем, что перемещает схват относительно тела, а часть перемещает тело относительно схвата. Эти задачи в достаточной степени различны, что выражается в разных нагрузочных режимах. С точки зрения кинематики движения задачи обратны, то есть если схват закреплён, то для переноса точки крепления к телу в заданном направлении нужно действовать, как если бы тело было неподвижно, а схват нужно было перемещать в направлении обратном требуемому (следует из принципа относительности Галилея при рассмотрении мгновенных входной и выходной систем координат.

В третьих, условия работы конечностей предполагают довольно высокий уровень шума. Поскольку масса конечности существенна по сравнению с массой всего тела, движение конечности передаётся в виде колебаний на корпус робота и через него на другие конечности. Поскольку конечности хотя бы попарны, каждая конечность имеет брата близнеца, всегда готового в случае излишне жёсткого регулирования войти с ней в резонанс. Ну... Если вы не хобот слона проектируете, конечно. Кстати, что до хоботов, гибкие конечности, такие как щупальца, повидимому гораздо меньше подвержены резонансным явлениям в силу маломощности отдельных актуаторов и высокому уровню демфирования, обеспеченному отсутствием жесткой ткани. Однако щупальца гораздо сложнее в точном управлении. В хоботе слона, согласно данным википедии 40000 мышечных пучков, при  том, что в теле человека их только 640-800 (по разным методикам подсчета). Незнаю, на сколько корректно сравнивать эти величины, но слоновий хобот, это, похоже, один из самых совершенных манипуляторов на планете. Нам до него еще расти и расти.

В целом, однако, это всё тот же манипулятор. По управлению манипуляторами у нас есть замечательная книжка "Основы управления манипуляционными роботами" [1], которую я всячески рекомендую всем интересующимся темой.

## По формализму операций с пространством.
Здесь и далее нам потребуется аппарат обобщённых координат и связанных с ними однородных преобразований. За кратким, но достаточно полным изложением его сути можно сходить в приведённую выши книжку, а я совсем сжато и опуская неиспользуемые возможности напомню. У нас есть три сущности:

Точка задаётся как объект линейного пространства [p_1, p_2, p_3 1].
Вектор задаётся как объект линейного пространства [p_1, p_2, p_3 0].
Положение системы координат задаётся в виде тензора:
P = [
r11 r12 r13 p1
r21 r22 r23 p2
r31 r32 r33 p3
  0   0   0  1
] = [ R T
000 1 ]
Здесь R - 3на3 матрица поворота, T вектор линейной трансляции.
Преобразование систем координат задаётся матрицей такого же вида, а составное преобразование есть произведение тензоров (линейных операторов).

Относительное C преобразование, удовлетворяющее уравнению B = AC, вычисляется как C = A^-1 B.

Оператор может выполнять преобразование над вектором или точкой. Для этого вектор или точка домножается на оператор справа.

V_1 = P_2^1 V_2.

Этого хватит для описания положений и взаимного развещения звеньев манипулятора.
Еще понадобится оператор кинематического переноса, отвечающий на вопрос, какой будет скорость точки, с радиус вектором r, если система кординат движется с линейной v и угловой \omega скоростями:

(\omega, v) = ... (\omega_ск, v_ск)

## Обзор задачи.

Самая базовая задача конечности - обеспечивать относительное положение входного и выходного звеньев. В такой постановке мы сразу формулируем задачи движения - и задачу перемещения тела относительно хвата и задачу перемещения хвата относительно тела. Есть и другие задачи. Например иногда позиционирование не требуется, а надо просто передавать усилие в нужном направлении. Кроме того нужно избегать некоторых конфигураций и вообще стараться находиться в наиболее энергетически выгодном состоянии. Согласно общему принципу, будем двигаться простыми путями и начнём с простого позиционирования.

Способов решения задачи позиционирования по сути два. Скоростной и координатный. Больше не придумали, все остальные сводятся к этим двум. 

При координатном мы стараемся расчитать такие положения суставов, в которых будет достигнуто целевое относительное расположение входного и выходного звеньев и переводим суставы согласно расщитанных координат. При достаточно тщательном разбиении траектории на траекторные точки можно обеспечить контроль весьма высокого качества. 

В скоростном, вместо того, чтобы расчитывать положение в точке следования, мы прикидываем, с какими скоростями должны двигаться суставы, чтобы относительное положение приближалось к требованию по кратчайшей траектории. 

Координатный способ предполагает решения обратной задачи кинематики, что, вообще говоря, нетривиально, ибо кинематика манипуляторов нелинейна. Координатный способ хорош при решении переодических задач точного позиционирования. Скоростной способ проще в реализации, но вычислительно накладней в рантайме, а еще он значительно лучше подходит цели непрерывного управления, поскольку координатный требует знания того, куда мы едем в то время как скоростной только знания того, с какой скоростью и в каком направлении мы едем.

Для того, чтобы понять, какими должны быть скорости в суставах \dot{q}, чтобы обеспечить движение в соответствии со скоростным векторным мотором (\omega, v), необходимо построить матрицу чувствительности (матрица частных производных Якоби) и решить систему линейных уравнений. Этим и займёмся.

## Два слова о физиологичности. 

Каждый раз, когда принимается то или иное техническое решение в деле создания автомотона, неявно звучит вопрос "А делает ли наша нервная система также". К сожалению, мне не удалось найти никаких источников, посвященных траекторному управлению в мозге, кроме разве что самых общих соображений. Есть некоторые причины считать, что мозг действительно использует скоростной метод на основе анализа "матрицы чувствительности". За это говорит наша любовь к прямолинейным перемещениям рук. Если не включая произвольный контроль "попросить" свою руку взять какой-то предмет, кисть начнёт двигаться по прямой с точностью до огибания препятствий, вне зависимости от сложности функций положений отдельных суставов. За координатные методы говорит нечуствительность системы к сингулярным состояниям, с которыми есть проблемы у скоростных методов (впрочем, в рамках скоростного подхода сингулярные состояния тоже можно победить). Естественно спросить, с чего мозгу вообще использовать что-либо из вышеперечисленного. Может эта система построена на совершенно отличных принципах, выходящих за рамки нашего понимания. Это возможно, но всё же маловероятно. Линейная алгебра - очень простой и универсальный метод, а от нейросетевых сумматоров до линейной алгебры один шаг. Эволюция не могла не нащупать эту возможность, хотя реализация может быть довольно своеобразной. Такова гипотеза.

Но почему мы должны считать, что система управления конечностями врождённая? Возможно, система управления движениями конечностей появляется в процессе обучения, о какой математике тогда вообще может идти речь. Как сложилась, так и работает. Но, мы знаем, что детёныши антилоп начинают ходить и даже бегать практически сразу после рождения. Им хватает десяти минут на калибровку. Врядли этого времени достаточно для того, чтобы разобраться в устройстве своих конечностей. А вот люди целый год не могут встать. А слонята, например, первые несколько лет не могут нормально использовать хобот, хотя прекрасно ходят и бегают. Таким образом, бывают и готовые системы, и такие, которые приходится долгое время тренировать и настраивать.

## Посчитаем матрицу Якоби



