

## Введение.

В настоящее время бурное развитие получили робототехнические системы, манипуляторы, позиционеры, станки ЧПУ, выполняющие задачу изменения положения рабочего органа (инструмента, схвата, зонда) в лабораторной системе координат и характеризующиеся цепной компоновкой кинематических звеньев.

Обратная задача кинематики, решение которой требуется для управления такими изделиями нелинейна, может иметь множество решений и представлять значительную вычислительную сложность. В связи с этим было разработано множество методов решения обратной задачи кинематики.

Часть методов, в особенности аналитических, построена для решения частных случаев задачи управления кинематической цепью и может быть применена только к ограниченному числу изделий. К числу этой категории методов также относятся методы, работающие только с одним типом кинематических звеньев (в основном с одностепенными поворотными звеньями).

Само по себе использование матрицы Якоби для расчета управления звеном кинематической цепи может быть не слишком удобным из-за неинтуитивности частных производных компонент тензора положения. В значительной степени неудобство управления в частных производных координат положения происходит из неочевидности физического смысла производных компонент объекта ориентации, который может задаваться матрицей размерности 3x3, или кватернионом, или быть частью более сложного алгебраического объекта, определяющего положение звена целиком, а именно матрицы размерности 4x4 или бикватерниона. Это ухудшает прозрачность алгоритма и увеличивает требования к квалификации разработчика програмного обеспечения конкретного изделия.

Для настоящего метода выбрано решение через скоростной аналог матрицы Якоби, характеризующий связь производных кинематических параметров с векторами линейной и угловой скоростей звеньев манипулятора. В работе показано, как решение скоростной задачи может быть использовано для координатно-траекторного управления широким классом открытых кинематических цепей. На основе метода приводится вариант алгоритма, достаточный для построения на его основе следящих систем, систем линейной интерполяции, а также достаточно простой для реализации в ЦПУ, ПЛИС, для управления реальным физическим объектом или моделью, а также обсуждаются варианты его модификации под ограничения конкретного объекта. Метод не налагает ограничения на класс кинематических пар и, хотя и разрабатывался для кинематических пар пятого класса, может быть применен для управления любой открытой кинематической цепью как из простых, так и из сложных звеньев.

Решение задачи представленна в тензорной нотации, ранее описанной автором в статьях. Использование тензорной нотации позволяет существенно сократить структурную схему системы и програмного кода при её реализации.


## Объект управления.

Основными объектами управления рассматриваемого в данной работе метода являются механизмы, роботы, манипуляторы, кинематика которых описываются простыми кинематическими цепями.

Типичным представителем таких механизмов являются роботы-манипуляторы.

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{manip1.jpg}
  \captionof{figure}{Манипулятор на поворотных звеньях. (Rozum Robotics)}
  \label{}
\end{center}

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{manip2.jpg}
  \captionof{figure}{Манипулятор на поворотных звеньях (FANUC R-1000iA80H)}
  \label{}
\end{center}

Управление положением схвата первично для таких изделий. Зачастую роботы манипуляторы имеют избыточную кинематику, что ставит вопрос о поиске управления, исключающего коллизии и сингулярные состояния.

Другой тип рассматриваемых объектов управления, позиционеры, сочетающие линейные и вращающие звенья:

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{actexample.jpg}
  \captionof{figure}{Позиционер с линейными и поворотными звеньями (Radioline PSR)}
  \label{}
\end{center}

Характеризуются меньшей избыточностью кинематики, имеют высокую жесткость и точность позиционирования.

В качестве перспективного направления развития метода рассматривается управление манипуляторами мобильных платформ (колёсных, шагающих, летающих).

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{mobile.jpg}
  \captionof{figure}{Мобильная платформа с манипулятором.}
  \label{}
\end{center}

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{fly.jpg}
  \captionof{figure}{Летающая платформа с манипулятором.}
  \label{}
\end{center}

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{centaurus.jpg}
  \captionof{figure}{Шагающая платформа с манипулятором.}
  \label{}
\end{center}

В качестве перспективного направления развития метода также рассматривается управление сложными схватами.

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{arm.jpg}
  \captionof{figure}{Пример сложного манипулятора.}
  \label{}
\end{center}

Эти объекты требуют синхронного многокоординатного управления положением, которое в рамках рассматриваемого метода осуществляется через построение следящей системы с модельной уставкой положения выходного звена/звеньев.



## \section{Системы координат.}

Рассмотрим открытую кинематическую цепь состоящей из простых кинематических звеньев. С каждым кинематическим звеном свяжем две локальные системы координат, распожив их в точках сочленения кинематических пар. Таким образом каждое кинематическое звено имеет входную и выходную ЛСК, жестко связанные с ним.

В сочленении кинематической пары также оказывается две системы координат - по одной для каждого звена пары (выходная первого звена и входная второго). Введем кинематические параметры звеньев $q_i$, определяющих взаимное расположение локальных систем координат.

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{ax3view.jpg}
  \captionof{figure}{Взаимное расположение систем координат для кинематического звена в виде поворотного шарнира.}
  \label{}
\end{center}

Таким образом кинематическая цепь определяется цепочкой локальных систем координат, положение каждой из которых определяется положением предыдущей и объектом гомогенного преобразования, либо константным, либо завищим от соответствующего кинематического параметра.

Пронумеруем звенья и системы координат. Пусть неподвижное кинематическое звено, жестко связанное с лабораторной системой координат считается 0-ым, лабораторная система координат считается 0-ой СК, пусть входная система каждого $n$-ого звена считается $n$-ой СК. Выходную систему кинематического звена обозначим как $n^*$. 

Если в нашей цепи $m$ звеньев, то СК выходного звена цепи будут иметь номера $m$ и $m*$.

Конкретный тип кинематического звена не имеет существенного значения в рамках метода, но желательно, чтобы объект гомогенного преобразования, связывающий системы координат $(n-1)*$ и $n$, зависел исключительно от обобщенных координат текущей кинематической пары.

Наиболее часто применяемым на практике является кинематическое звено в виде одностепенного поворотного шарнира с объектом преобразования:
\begin{equation}
H^i_{{i-1}^*} = |\rho, r| = |\phi|u_1, u_2, u_3|, |0, 0, 0||
\end{equation}, где $\phi$ - обобщенная координата.

Также интерес представляет актуаторное звено, реализующее линейное перемещение и имеющее объект преобразования:
\begin{equation}
H^i_{{i-1}^*} = |\rho, r| = ||0, 0, 0|, l|u_1, u_2, u_3||
\end{equation}, где $l$ - обобщенная координата.

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{actexample.jpg}
  \captionof{figure}{Пример системы с актуаторными кинематическими звеньями..}
  \label{}
\end{center}

\begin{center}
  \includegraphics[width=0.6\textwidth,height=0.6\textheight,keepaspectratio]{actsyst.jpg}
  \captionof{figure}{Взаимное расположение систем координат для актуаторного кинематического звена.}
  \label{}
\end{center}

Введение иных кинематических звеньев также возможно, не нарушает вывода, но выходит за рамки настоящего изложения. Введение кинематических пар класса отличного от пятого, хотя и не рассматривается в данной работе не нарушает общности метода, поскольку всегда можно считать, что две или более координаты кинематической пары связаны звеном с единичным объектом преобразования $H^i_{{i-1}^*} = ||0, 0, 0| |0, 0, 0||$.


## Манипулятор как группа органов управления.

Манипулятор можно рассмотреть как систему иерархически связанных систем координат. Положение какого-либо звена может быть рассмотрено как произведение локальных тензоров положений всех предыдущих систем координат.

P_i = P_i-1 L_i = L_1 L_2 ... L_i

Возьмем производную глобального положения звена по вектору q, учитывая, что тензоры локальных положений зависят только от собственной обобщённой координаты и не зависят от остальных.

dP_i/dq = summ(j, 0, i) L_1 L_2 ... dL_j/dq_j ... L_i

Из этого выражения видно, что скорость выходного звена является линейной комбинацией скоростей обобщённых координат.

Выражение () является оператором, связывающим производную координаты с вектором чувствительности положения выходного звена. Преобразуем выражение. 

Здесь 
R - оператор переноса из i-ой системы в выходную. 
H - тензор локальной чувствительности i ой пары.
X - глобальный тензор положения i ой системы координат.

Таким образом скорость выходного звена есть суперпозиция скоростей обобщённых координат, вектора чувствительности к которым определяются из текущей геометрии манипулятора по формуле ().

В работе показано, что группа органов управления, генерирующая управляющее воздействие в виде линейной комбинации можетбыть использована для построения системы автоматического регулирования, поскольку позволяет путём решения системы линейных уравнений на основе желаемой скорости выходного звена выбирать скорости обобщённых координат.

## Следящая система.

\section{Следящая система управления положением звена.}

С увеличением сложности объекта управления более успешными становятся сложные, многокаскадные системы управления. Попытка внедрения функционала прохождения траектории или обхода препятствий непосредственно в алгоритм системы стабилизации или системы задания координат, хотя и может претендовать на достижения неких оптимальных показателей, представляется сомнительной с инженерной точки зрения, поскольку приводит к сильной связности алгоритмов управления, неочевидности поведения системы, требует трудоёмкой аналитической переработки при внесении изменений в функционал управления, повышает требования к квалификации работников технического сопровождения.

Разделив задачу управления на несколько слабо связанных задач, можно использовать каждое из них для введения уставки следующей. Так мы можем задавшись некоторыми ограничениями на динамические возможностями нашей системы, построить решение задачи траекторного управления достаточной точности, учитывающее обход препятствий всеми звеньями кинематической цепи без необходимости просчета временных функции кинематических координат $q_i(t)$. 

С другой стороны мы обеспечиваем решение задачи координатного управления, чтобы все уставки $P_i(t)$ выданные для каждого момента времени траекторным алгоритмом выполнялись с необходимой точностью.

Такое разбиение позволяет координатному решателю не заботиться о геометрических ограничениях ввиду того, что они учтены траекторным решателем, а траекторный решатель может расчитывать управление траектории в удобных для этой задачи координатах, поскольку не связан необходимостью физического управления изделием.   

\begin{center}
  \includegraphics[width=\textwidth,height=\textheight,keepaspectratio]{ctrsyst.png}
  \captionof{figure}{Структурная схема следящей системы.}
  \label{}
\end{center}

Получив решение обратной скоростной задачи мы получили возможность синтезировать управления заданного 6-скоростью объекта положения звена. Однако, обычно, целью позиционера является управлением положением звена, а не его скоростью.

Прямое решение задачи управления положением через интеграл скоростного управления, очевидно, очень быстро приведет к накоплению вычислительной ошибки.

Чтобы исключить вычислительную ошибку зададимся модельным положением управляемого звена. Пусть задача траекторного управления вырабатывает уставку в виде текущих объектов положения $U(t)$ и скорости $\dot{U}(t)$.

Используем объект уставки как основной сигнал управления (прямое управление), а объект положения для вычисления ошибки $E(t)$ в цепи обратной связи.

Тогда система управления будет отрабатывать управляющее воздействие $\dot{U}(t)$, замешивая в него с небольшим коэффициентом ошибку по положению $E(t)$.

Компенсация $E(t)$ вносится в форме 6-вектора положения взвешенного на соответствующий коэффициент усиления.

Если сумирование компоненты линейной скорости уставки и взвешенного сигнала ошибки положения не вызывает вопросов в силу линейности преобразований координат и линейных скоростей, то сумирование компонент угловой скорости и взвешенных компонент вектора поворота необходимо обосновать.

Возьмём вектор компенсации $\Omega_e$ сонаправленный сигналу ошибки углового положения $\rho_e$ и равный по модулю $K|\rho_e|$, где $K$ размерный коэффициент приведения.
Разложим вектор компенсации $\Omega_e$ на аксиальную и тангенсальную к вектору $\omega_u$ направления.   

Тогда сумарный вектор угловой скорости будет иметь вид 
\begin{equation}
\omega = |\omega_u + \omega_e^{tang}|\bar{t} + |\omega_e^{norm}|\bar{n}
\end{equation} 
Тангенсальная компонента $\omega_e^{tang}$ прямо корректирует модуль $\omega_u$, ускоряя или замедляя воздействие исходя из текущей ошибки. Компонент $\omega_e^{norm}$ подворачивает звено к ориентации модельного положения. В силу ортогональности управления по тангенсальному и нормальному ортам можно считать независимым при достаточно малом вычислительном шаге.

Надо отметить, что ошибка углового положения более неприятна для системы в целом, поскольку приводит к повороту базиса и переносу ошибки на компоненты линейного положения. Соответственно, следует либо устанавливать высокие требования к динамической точности такой системы, либо осуществлять предобработку сигнала управления путём переноса в связанный базис. 

На текущий момент доказательством устуйчивости построенной СУ является вычислительный эксперимент. Аналитической исследование устойчивости системы управления выходит за рамки настоящего изложения. Наработка методов анализа устойчивости систем управления объектами работающими в трехмерном пространстве является перспективным направлением развития настоящей работы. 

Следует также отметить, что может быть построена система управления исключительно по сигналу $E(t)$ без прямого управления по $U(t)$. Такая система имеет лучшую устойчивость и не имеет проблемы переноса ошибки углового положения на компоненты линейного, но имеет худшее быстродействие и может иметь статическую ошибку в режиме движения с ненулевой скоростью.

\section{Учет ограничений и весов на уровне координатного решателя. Метод исключения координат.}

При том, что концептуально учет ограничений должен производится на уровне траекторного решателя и приблизительно формулироваться как <<Вышестоящей системе не следует задавать управления, которое нижестоящая не может выполнить>>, полезно рассмотреть возможности внесения ограничений на уровне кординатного решателя.

Как было указано ранее в разделе \ref{invspd_sect}, есть множество вариантов выбора коэффициентов линейной комбинации, удовлетворяющих заданной траектории. Выбор конкретной комбинации зависит от выбранного математического метода и его параметров. Имея на входе 6-вектор потребной скорости, а на выходе вектор производных кинематических координат, координатный решатель с точки зрения остальной системы представляет собой черный ящик и слабо связан с её работой в целом.

Таким образом, изменяя внутреннее устройство координатного решателя мы можем добиться поведения системы, учитывающего необходимые ограничения.
\begin{equation}
\dot{q}(t) = F(V(t), Z(q,\dot{q},t)) 
\end{equation}, где F - функция координатного решателя, а $Z(q,\dot{q},t))$ - дополнительные аргументы, учитывающие текущие ограничения.   

Возможности введения ограничений напрямую зависит от выбраного $F$ метода метода решения поиска комбинации. Некоторые классы рассматриваемых ограничений не могут быть достигнуты при одном выборе функции $F$, но могут быть достигнуты при другом. Исходя из этого, конкретный выбор $F$ должен осуществляться из соображений оптимальности вычислительной реализации в конкретном решателе и возможности учёта необходимых ограничений.

В разделе \ref{invspd_sect} были рассмотрены два метода поиска вектора коэффициентов линейной комбинации. Рассмотрим возможность внесения ограничений в каждый из них.

Метод координатного спуска достаточно легко подвергается модификации и имеет множество параметров. Мы можем варьировать множители для спуска по конкретным координатам вплоть до возможности обнуления приращения в случае, если скалярное произведение целевого 6-вектора и 6-вектора чувствительности по соответствующей координате направлены в неудобную сторону, например если дальнейшее движение по этой координате приведет к столкновению с ограничителем. Метод координатного спуска позволяет достаточно вольно учитывать ограничения и удобен для их внесения. Анализ конкретных алгоритмов введения весов и ограничений выходит за рамки настоящего изложения. 

Метод решения СЛАУ через поиск псевдообратной матрицы гораздо более строг алгоритмически и не позволяет такого вольного обращения с собой, как метод координатного спуска. Однако и здесь мы можем рассмотреть некоторые возможности влиять на результат вычисления.

Один из возможных способов выполнить ограничения на координату
\begin{equation}
q^i_{min} < q^i < q^i_{max} 
\end{equation} является метод исключения координаты. При его использовании, если решение СЛАУ даёт $\dot{q}^i$ такое что, $q^i$ стремится покинуть рабочую зону, мы исключаем координату $q^i$ из вектора кинематических параметров и проводим решение СЛАУ повторно. $\dot{q}^i$ при этом считается равным нулю на текущей итерации. Следует учесть, что такой метод может приводить к резкому останову и не быть приемлемым.

Автор полагает, что может быть найден метод решения поиска поиска линейной комбинации, лучше подходящий для внесения весов и ограничений, вместе с тем достаточно хороший для вычислительной реализации в ЦПУ или ПЛИС.

Особый интерес представляет поиск такого алгоритма, в котором положительная и отрицательная скорости по каким-либо координатам будут иметь разные веса. 

Удобно то, что декомпозиция на траекторную и координатную задачи позволяет эксперементировать с координатным алгоритмом независимо от архитектуры системы в целом.

\section{Учет ограничений на уровне траекторного решателя. Разбиение кинематической цепи. Введение дополнительных параметров.}\label{restr_traj}

Очевидным ограничением траекторного управления выходным звеном кинематической цепи является недопустимость выхода положения уставки за границы досягаемости манипулятора. Построение зоны допустимых положений манипулятора как правило является достаточно простой задачей и зачастую для ее решения достаточно проанализировать движение в условиях крайних положений нескольких обобщенных координат.

Более сложным вопросом является недопущение самопересечений (внутренних столкновений) звеньев цепи, но на практике такая проблема возникает не часто, в силу того, что сильно кинематически избыточные системы не применяются на практике.

Если же в силу избыточности кинематической цепи координатный алгоритм приводит кинематическую цепь в неслишком естественное положение, положение характеризуемое большой нагрузкой или, возможно сингулярным состоянием, мы можем озаботится дополнительными параметрами управления, тем самым снижая свободу цепи. 

Радикальным методом решения этой проблемы будет исключения части координат из вектора синтезируемого управления на специальных режимах работы, или использование разных участков кинематической цепи для решения разных задач. 

Рассмотрим другой вариант решения этой задачи. Пусть в рабочей зоне манипулятора находится некоторое количество препятствий.

Найдём точку (точки) наимение удалённую от препятствия.Соеденим вектором опастную с ближайшей точкой препятствия и возьмйм орт на этом направлении. Собственная скорость в проекции на найденный орт является взвешенной суммой проекций скоростей следующего и предущего базисов на тот же орт.

Частные производные по компонентам скоростей могут быть расчитаны согласно формуле линейной интерполяции как:
\begin{equation}
k = \frac{\bar{r}_i^a}{\bar{r}_i^{i+1}} 
\end{equation}
\begin{equation}
J_a = J_i (1-k) + J_{i+1} k
\end{equation}

Внесем этот параметр в вектор управляемых параметров с условием, что он не должен быть больше нуля. Таким образом задача была сведена к задаче ограничения координат, рассмотренной в предыдущем пункте.

Существует множество других вариантов внесения траекторных ограничений, рассмотрение которых выходит за рамки настоящей работы.


